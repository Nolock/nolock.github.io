<!DOCTYPE html>
<html>

<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <!-- Site Properties -->
    <title>Einloggen - Nolock</title>
    <link rel="stylesheet" type="text/css" href="dist/components/reset.css">
    <link rel="stylesheet" type="text/css" href="dist/components/site.css">

    <link rel="stylesheet" type="text/css" href="dist/components/container.css">
    <link rel="stylesheet" type="text/css" href="dist/components/grid.css">
    <link rel="stylesheet" type="text/css" href="dist/components/header.css">
    <link rel="stylesheet" type="text/css" href="dist/components/image.css">
    <link rel="stylesheet" type="text/css" href="dist/components/menu.css">

    <link rel="stylesheet" type="text/css" href="dist/components/divider.css">
    <link rel="stylesheet" type="text/css" href="dist/components/segment.css">
    <link rel="stylesheet" type="text/css" href="dist/components/form.css">
    <link rel="stylesheet" type="text/css" href="dist/components/input.css">
    <link rel="stylesheet" type="text/css" href="dist/components/button.css">
    <link rel="stylesheet" type="text/css" href="dist/components/list.css">
    <link rel="stylesheet" type="text/css" href="dist/components/message.css">
    <link rel="stylesheet" type="text/css" href="dist/components/icon.css">

    <script src="js/jquery.min.js"></script>
    <script src="dist/components/form.js"></script>
    <script src="dist/components/transition.js"></script>

    <script src="js/Nolock.js"></script>

    <style type="text/css">
        body {
            background-color: #f5f5f5;
        }

        body>.grid {
            height: 100%;
        }

        .image {
            margin-top: -100px;
        }

        .column {
            max-width: 450px;
        }
    </style>



    <!-- -->
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="557332976975-4i9i6nh1v7n5gohjijd6947cmmupctun.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!-- -->


    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <script src="https://apis.google.com/js/api:client.js"></script>
    <script>
        //google login
        var googleUser = {};
        var startApp = function() {
            gapi.load('auth2', function() {
                // Retrieve the singleton for the GoogleAuth library and set up the client.
                auth2 = gapi.auth2.init({
                    client_id: '557332976975-4i9i6nh1v7n5gohjijd6947cmmupctun.apps.googleusercontent.com',
                    cookiepolicy: 'single_host_origin',
                    // Request scopes in addition to 'profile' and 'email'
                    //scope: 'additional_scope'
                });
                attachSignin(document.getElementById('customBtn'));
            });
        };

        function attachSignin(element) {
            auth2.attachClickHandler(element, {},
                function(googleUser) { ///////////////////////////////////////
                    var profile = googleUser.getBasicProfile();

                    var id_token = googleUser.getAuthResponse().id_token;
                    console.log("ID Token: " + id_token);

                    $.get("http://srv10821.kvm-system.de/nolock.php", {
                            googletoken: id_token
                        })
                        .done(function(data) {

                            if (data.indexOf("000") != -1) {

                                localStorage.setItem("Benutzer", profile.getName());
                                localStorage.setItem("Email", profile.getEmail());
                                localStorage.setItem("Benutzerbild", profile.getImageUrl());
                                localStorage.setItem("googleLogin", "True");
                                //gsession rausfiltern
                                var start = data.indexOf("=") + 1;
                                var ende = data.indexOf("]");
                                var gsession = data.slice(start,ende);
                                //alert(gsession);
                                localStorage.setItem("gsession", ""+gsession);
                                saveLogin();
                            } else {
                                alert("Google Login fehlgeschlagen!");
                            }
                        });

                },
                function(error) {
                    //alert(JSON.stringify(error, undefined, 2));
                });

        }
    </script>
</head>

<body>

    <div class="ui middle aligned center aligned grid">
        <div class="column">
            <h2 class="ui teal image header">
      <img src="logo.png" class="image">
      <div class="content">
        Logge dich ein
      </div>
    </h2>
            <form class="ui large form">
                <div class="ui stacked segment">
                    <div class="field">
                        <div class="ui left icon input">
                            <i class="user icon"></i>
                            <input id="username" type="text" name="email" placeholder="Benutzername">
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui left icon input">
                            <i class="lock icon"></i>
                            <input id="password" type="password" name="password" placeholder="Passwort">
                        </div>
                    </div>
                    <div id="login" onclick="onClickLogin()" class="ui fluid large teal submit button">Login</div>
                    <div class="ui divider"></div>
                    <div id="customBtn" class="g-customGPlusSignIn ui fluid large orange submit button">Google Login</div>
                </div>

                <div class="ui error message"></div>

            </form>

            <div class="ui message">
                Noch kein Konto? <a href="signup.html">Sign Up</a>
            </div>
        </div>
    </div>
    <script src="js/fastclick.js"></script>
    <script>
        checkLogin();
        addFastClick();

        $(document).keypress(function(e) {
            if (e.which == 13) {
                onClickLogin();
            }
        });
    </script>
    <script>
        startApp();
    </script>

</body>

</html>
